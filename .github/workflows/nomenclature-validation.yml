name: Nomenclature Standard Validation

on:
  push:
    branches: ['**']
  pull_request:
    branches: ['**']

jobs:
  validate-nomenclature:
    runs-on: ubuntu-latest
    name: Validate File Nomenclature
    
    permissions:
      contents: read
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pyyaml
      
      - name: Validate all files (PR-BLOCKING)
        id: validate
        run: |
          echo "Running nomenclature validation (PR-BLOCKING MODE)..."
          echo "=================================================="
          python validate_nomenclature.py --check-all --strict --verbose
          EXIT_CODE=$?
          echo "=================================================="
          if [ $EXIT_CODE -ne 0 ]; then
            echo ""
            echo "❌ NOMENCLATURE VALIDATION FAILED - PR BLOCKED"
            echo ""
            echo "Please ensure all files follow the nomenclature standard v5.0:"
            echo "[ATA_ROOT]_[PROJECT]_[PROGRAM]_[VARIANT]_[BLOCK]_[PHASE]_[KNOT_TASK]_[AoR]__[SUBJECT]_[TYPE]_[VERSION]_[STATUS].[EXT]"
            echo ""
            echo "Documentation:"
            echo "  - Standard: docs/standards/NOMENCLATURE_v5_0.md"
            echo "  - Quick ref: docs/standards/NOMENCLATURE_v5_0_QUICKREF.md"
            echo "  - Scaffold: python scripts/scaffold.py"
            echo ""
            echo "This check is BLOCKING and must pass before the PR can be merged."
            exit 1
          fi
          echo ""
          echo "✅ All files comply with nomenclature standard v5.0!"
