name: Nomenclature Standard Validation

on:
  push:
    branches: ['**']
  pull_request:
    branches: ['**']

jobs:
  validate-nomenclature:
    runs-on: ubuntu-latest
    name: Validate File Nomenclature
    
    permissions:
      contents: read
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pyyaml
      
      - name: Validate all files (R1.0 - Warn Mode)
        id: validate_r1
        run: |
          echo "Running nomenclature validation (R1.0 in WARN mode)..."
          python validate_nomenclature.py --standard R1.0 --check-all --strict --verbose --mode warn
        continue-on-error: true
      
      - name: Validate all files (v5.0 - Block Mode)
        id: validate_v5
        run: |
          echo "Running nomenclature validation (v5.0 in BLOCK mode)..."
          python validate_nomenclature.py --standard v5.0 --check-all --strict --verbose --mode block
        continue-on-error: true
      
      - name: Check validation result
        if: steps.validate_v5.outcome == 'failure'
        run: |
          echo "❌ Nomenclature validation failed!"
          echo "Please ensure all files follow the nomenclature standard."
          echo ""
          echo "Current standard: v5.0 (12 fields)"
          echo "[ATA_ROOT]_[PROJECT]_[PROGRAM]_[VARIANT]_[BLOCK]_[PHASE]_[KNOT_TASK]_[AoR]__[SUBJECT]_[TYPE]_[VERSION]_[STATUS].[EXT]"
          echo ""
          echo "See docs/standards/NOMENCLATURE_v5_0.md for v5.0 details."
          echo ""
          echo "Note: R1.0 (v6.0) validation is in WARN mode (14 fields)."
          echo "See docs/standards/NOMENCLATURE_R1_0.md for R1.0 details."
          exit 1
      
      - name: Validation success
        if: steps.validate_v5.outcome == 'success'
        run: |
          echo "✅ All files comply with nomenclature standard v5.0!"
          echo "ℹ️  R1.0 validation results shown above (warn mode - informational only)."
