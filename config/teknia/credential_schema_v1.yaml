---
# TEKNIA Credential Schema v1.0
# 
# This schema defines the structure and validation rules for TEKNIA credentials.
# TEKNIA credentials are separate controlled artifacts (badges, certs, licenses)
# that bind to subject NKUs with cryptographic integrity.
# 
# Governance:
# - Issuance: Only CM or CERT AoR can issue credentials
# - Schema changes: Require CM approval and version increment
# - Validation: CI-enforced via JSON Schema or equivalent

schema_version: "1.0"
date: "2025-12-17"
status: "Normative"
owner: "Configuration Management WG"

# JSON Schema for TEKNIA credentials
# This can be used for automated validation
json_schema:
  $schema: "http://json-schema.org/draft-07/schema#"
  title: "TEKNIA Credential"
  description: "Schema for TEKNIA credentials (badges, certificates, licenses)"
  type: "object"
  
  required:
    - schema_version
    - issued_by_aor
    - issued_by_actor
    - issued_at
    - credential_type
    - subject_path
    - subject_sha256
    - scope
  
  properties:
    
    schema_version:
      type: "string"
      description: "Version of this credential schema"
      enum: ["1.0"]
      example: "1.0"
    
    issued_by_aor:
      type: "string"
      description: "Area of Responsibility issuing the credential"
      enum: ["CM", "CERT"]
      example: "CM"
    
    issued_by_actor:
      type: "string"
      description: "Identity of the issuer (person or system)"
      minLength: 1
      maxLength: 100
      example: "John Doe <john.doe@ampel360.com>"
    
    issued_at:
      type: "string"
      format: "date-time"
      description: "Timestamp when credential was issued (ISO8601)"
      example: "2025-12-17T00:00:00Z"
    
    credential_type:
      type: "string"
      description: "Type of credential"
      enum: ["BADGE", "CERT", "LIC"]
      example: "BADGE"
    
    subject_path:
      type: "string"
      description: "Repository-relative path to the subject artifact (NKU)"
      minLength: 1
      maxLength: 500
      pattern: "^[a-zA-Z0-9/_.-]+$"
      example: "docs/standards/NOMENCLATURE_v5_0.md"
    
    subject_sha256:
      type: "string"
      description: "SHA-256 hash of the subject artifact content"
      pattern: "^[a-fA-F0-9]{64}$"
      example: "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"
    
    subject_commit:
      type: "string"
      description: "Git commit SHA of the subject artifact (optional)"
      pattern: "^[a-fA-F0-9]{40}$"
      example: "a1b2c3d4e5f6789012345678901234567890abcd"
    
    scope:
      type: "object"
      description: "Structured scope definition for the credential"
      additionalProperties: true
      example:
        domain: "safety"
        level: "L3"
        category: "hazard-analysis"
    
    claims:
      type: "object"
      description: "Structured claims asserted by the credential"
      additionalProperties: true
      example:
        compliance: ["ARP4754A", "DO-178C"]
        review_status: "approved"
        expires_at: "2026-12-17T00:00:00Z"
    
    metadata:
      type: "object"
      description: "Additional metadata (optional)"
      properties:
        title:
          type: "string"
          description: "Human-readable title"
        description:
          type: "string"
          description: "Human-readable description"
        tags:
          type: "array"
          items:
            type: "string"
          description: "Searchable tags"
      additionalProperties: true

# Validation rules
validation_rules:
  
  issuance_aor:
    rule: "issued_by_aor must be CM or CERT"
    enforcement: "CI-blocking"
    rationale: "Only CM and CERT have authority to issue credentials"
  
  subject_integrity:
    rule: "subject_sha256 must match actual SHA-256 of subject_path content"
    enforcement: "CI-blocking"
    rationale: "Ensures credential binds to specific content version"
  
  subject_path:
    rule: "subject_path must exist in repository"
    enforcement: "CI-blocking"
    rationale: "Credentials must reference valid artifacts"
  
  credential_type:
    rule: "credential_type must be BADGE, CERT, or LIC"
    enforcement: "CI-blocking"
    rationale: "Only approved credential types allowed"
  
  timestamp_format:
    rule: "issued_at must be valid ISO8601 timestamp"
    enforcement: "CI-blocking"
    rationale: "Ensures consistent timestamp format"
  
  schema_version:
    rule: "schema_version must match current schema version"
    enforcement: "CI-blocking"
    rationale: "Ensures credentials use current schema"

# Credential types and their semantics
credential_types:
  
  BADGE:
    description: "Attestation of quality, completeness, or compliance"
    typical_scope:
      - quality_level
      - completeness_criteria
      - review_status
    typical_claims:
      - review_date
      - reviewer
      - criteria_met
    examples:
      - "Review completed badge"
      - "Quality gate passed badge"
      - "Compliance verified badge"
  
  CERT:
    description: "Formal certification or authorization"
    typical_scope:
      - certification_body
      - certification_standard
      - certification_level
    typical_claims:
      - certification_date
      - expires_at
      - certificate_number
      - certifying_authority
    examples:
      - "Safety certification"
      - "Airworthiness certification"
      - "DO-178C certification"
  
  LIC:
    description: "License or permission grant"
    typical_scope:
      - license_type
      - license_terms
      - licensee
    typical_claims:
      - issued_date
      - expires_at
      - license_number
      - restrictions
    examples:
      - "Usage license"
      - "Export license"
      - "Release license"

# Issuance workflow
issuance_workflow:
  steps:
    - step: 1
      action: "Propose credential"
      actor: "Any AoR"
      output: "Credential proposal (draft)"
    
    - step: 2
      action: "Review proposal"
      actor: "CM or CERT"
      output: "Approval or rejection"
    
    - step: 3
      action: "Issue credential"
      actor: "CM or CERT"
      output: "Signed credential file"
    
    - step: 4
      action: "Commit credential"
      actor: "CM or CERT"
      output: "Credential in repository"
    
    - step: 5
      action: "Validate credential"
      actor: "CI/CD pipeline"
      output: "Validation pass/fail"
  
  naming_convention:
    format: "[ATA_ROOT]_[PROJECT]_[PROGRAM]_[VARIANT]_[BLOCK]_[PHASE]_[KNOT_TASK]_[AoR]__[SUBJECT]_[TYPE]_[VERSION]_[STATUS].[EXT]"
    example: "00_AMPEL360_SPACET_PLUS_CM_SB01_K01_CM__nomenclature-v5-compliance_BADGE_I01-R01_RELEASED.yml"
    notes:
      - "TYPE must be BADGE, CERT, or LIC"
      - "AoR must be CM or CERT (issuer)"
      - "EXT should be yml or json for diff-friendliness"

# Example credentials
examples:
  
  - name: "Review Completed Badge"
    file_content: |
      ---
      schema_version: "1.0"
      issued_by_aor: "CM"
      issued_by_actor: "Configuration Management System"
      issued_at: "2025-12-17T10:30:00Z"
      credential_type: "BADGE"
      subject_path: "docs/standards/NOMENCLATURE_v5_0.md"
      subject_sha256: "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"
      subject_commit: "a1b2c3d4e5f6789012345678901234567890abcd"
      scope:
        review_type: "technical"
        review_depth: "comprehensive"
      claims:
        review_completed: true
        reviewer: "Jane Smith"
        review_date: "2025-12-17"
        criteria_met: ["completeness", "accuracy", "consistency"]
      metadata:
        title: "Technical Review Completion Badge"
        description: "Certifies that Nomenclature v5.0 has passed technical review"
        tags: ["review", "governance", "nomenclature"]
  
  - name: "Safety Certification"
    file_content: |
      ---
      schema_version: "1.0"
      issued_by_aor: "CERT"
      issued_by_actor: "Certification Authority"
      issued_at: "2025-12-17T14:00:00Z"
      credential_type: "CERT"
      subject_path: "00_AMPEL360_SPACET_PLUS_SAF_LC07_K02_SAF__propulsion-fha_FHA_I01-R01_APPROVED.md"
      subject_sha256: "abcd1234567890abcdef1234567890abcdef1234567890abcdef1234567890ab"
      subject_commit: "b2c3d4e5f67890123456789012345678901234abcd"
      scope:
        certification_body: "EASA"
        certification_standard: "ARP4761"
        certification_level: "DAL-B"
      claims:
        certification_date: "2025-12-17"
        expires_at: "2027-12-17T00:00:00Z"
        certificate_number: "CERT-2025-1234"
        certifying_authority: "EASA Part-21J Authority"
        compliance: ["ARP4761", "ARP4754A"]
      metadata:
        title: "Propulsion FHA Safety Certification"
        description: "EASA certification for propulsion system FHA"
        tags: ["safety", "certification", "propulsion", "fha"]

# Change control
change_control:
  authority: "Configuration Management Working Group"
  schema_version_policy: "Major version increment for breaking changes, minor for additions"
  approval_required_for:
    - "Schema structure changes"
    - "New required fields"
    - "New credential types"
    - "Validation rule changes"
  
  process:
    - "Submit schema change request to CM WG"
    - "Impact analysis and review"
    - "Approval decision"
    - "Update schema and increment version"
    - "Update tooling and documentation"
    - "Migrate existing credentials if needed"

# References
references:
  - "Nomenclature Standard v5.0"
  - "AMPEL360 Configuration Management Plan"
  - "JSON Schema Specification: https://json-schema.org/"
  - "ISO 8601 Date and Time Format"
  - "SHA-256 Cryptographic Hash Standard"

# Version history
history:
  - version: "1.0"
    date: "2025-12-17"
    changes: "Initial TEKNIA credential schema"
    author: "CM WG"
